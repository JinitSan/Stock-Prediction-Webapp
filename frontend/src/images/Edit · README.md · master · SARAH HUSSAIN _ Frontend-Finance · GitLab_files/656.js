(this.webpackJsonp=this.webpackJsonp||[]).push([[656],{BRyS:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));n("EWC9"),n("Ag57"),n("GzNv"),n("S26F"),n("pBsb"),n("orcL");var i=n("MCZX"),o=n("cm1E");function r(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}const s=new RegExp("#?L","g"),a=function(e){const t=new DocumentFragment,n=document.createElement("a");return n.classList.add("link-anchor"),n.href=e,t.appendChild(n),n.addEventListener("contextmenu",(function(e){e.stopPropagation()})),t};class c{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{instance:t}=e,n=r(e,["instance"]);if(t)Object.assign(t,n),c.highlightLines(t),t.getEditorType&&t.getEditorType()===o.f&&c.setupLineLinking(t);else if(Object.entries(n).length)throw new Error(o.h)}static highlightLines(e){const{hash:t}=window.location;if(!t)return;const[n,o]=t.replace(s,"").split("-");let r=n?parseInt(n,10):null,a=o?parseInt(o,10):r;a<r&&([r,a]=[a,r]),r&&window.requestAnimationFrame((function(){e.revealLineInCenter(r),Object.assign(e,{lineDecorations:e.deltaDecorations([],[{range:new i.Range(r,1,a,1),options:{isWholeLine:!0,className:"active-line-text"}}])})}))}static onMouseMoveHandler(e){const t=e.target.element;if(t.classList.contains("line-numbers")){const n=e.target.position.lineNumber,i="#L".concat(n);let o=t.querySelector("a");o||(o=a(i),t.appendChild(o))}}static setupLineLinking(e){e.onMouseMove(c.onMouseMoveHandler),e.onMouseDown((function(t){t.target.element.classList.contains("link-anchor")&&e.lineDecorations&&e.deltaDecorations(e.lineDecorations,[])}))}}},DNyI:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return M}));n("jaBk");var i=n("EmJ/"),o=n.n(i),r=n("MeWm"),s=n("MCZX"),a=n("BRyS");class c extends a.a{navigateFileStart(){this.setPosition(new s.Position(1,1))}}var l=n("XRO8"),d=n("2ibD"),p=n("tXF7"),u=n("0AwG"),h=(n("pBsb"),n("orcL"),n("qPgm")),g=n("BaXK"),f=n("/lV4"),m=n("udiD"),w=n("m/7A");class S{constructor(e){this.mediator=e,this.$dropdown=null,this.$wrapper=null}init(){const e=this.config;this.$dropdown=o()(e.dropdown),this.$wrapper=o()(e.wrapper),this.$dropdownIcon=this.$wrapper.find(".dropdown-menu-toggle-icon"),this.$loadingIcon=o()('<div class="gl-spinner gl-spinner-orange gl-spinner-sm gl-absolute gl-top-3 gl-right-3 gl-display-none"></div>').insertAfter(this.$dropdownIcon),this.$dropdownToggleText=this.$wrapper.find(".dropdown-toggle-text"),this.initDropdown(),this.selectInitialTemplate()}selectInitialTemplate(){const e=this.$dropdown.data("selected");e&&this.mediator.selectTemplateFile(this,e)}show(){var e=this;null===this.$dropdown&&this.init(),this.$wrapper.removeClass("hidden"),setTimeout((function(){e.$dropdown.focus()}),0)}hide(){null!==this.$dropdown&&this.$wrapper.addClass("hidden")}isHidden(){return!this.$wrapper||this.$wrapper.hasClass("hidden")}getToggleText(){return this.$dropdownToggleText.text()}setToggleText(e){this.$dropdownToggleText.text(e)}renderLoading(){this.$loadingIcon.removeClass("gl-display-none"),this.$dropdownIcon.addClass("gl-display-none")}renderLoaded(){this.$loadingIcon.addClass("gl-display-none"),this.$dropdownIcon.removeClass("gl-display-none")}reportSelection(e){const{query:t,e:n,data:i}=e;return n.preventDefault(),this.mediator.selectTemplateFile(this,t,i)}reportSelectionName(e){const t=e;t.query=e.selectedObj.name,t.data=e.selectedObj,t.data.source_template_project_id=e.selectedObj.project_id,this.reportSelection(t)}}class b extends S{constructor(e){let{mediator:t}=e;super(t),this.config={key:"gitlab-ci-yaml",name:".gitlab-ci.yml",pattern:/(.gitlab-ci.yml)/,type:"gitlab_ci_syntax_ymls",dropdown:".js-gitlab-ci-syntax-yml-selector",wrapper:".js-gitlab-ci-syntax-yml-selector-wrap"}}initDropdown(){var e=this;Object(w.a)(this.$dropdown,{data:this.$dropdown.data("data"),filterable:!0,selectable:!0,search:{fields:["name"]},clicked:function(t){return e.reportSelectionName(t)},text:function(e){return e.name}})}}class y extends S{constructor(e){let{mediator:t}=e;super(t),this.config={key:"gitlab-ci-yaml",name:".gitlab-ci.yml",pattern:/(.gitlab-ci.yml)/,type:"gitlab_ci_ymls",dropdown:".js-gitlab-ci-yml-selector",wrapper:".js-gitlab-ci-yml-selector-wrap"}}initDropdown(){var e=this;Object(w.a)(this.$dropdown,{data:this.$dropdown.data("data"),filterable:!0,selectable:!0,search:{fields:["name"]},clicked:function(t){return e.reportSelectionName(t)},text:function(e){return e.name}})}}class T extends S{constructor(e){let{mediator:t}=e;super(t),this.config={key:"dockerfile",name:Object(f.a)("Dockerfile"),pattern:/(Dockerfile)/,type:"dockerfiles",dropdown:".js-dockerfile-selector",wrapper:".js-dockerfile-selector-wrap"}}initDropdown(){var e=this;Object(w.a)(this.$dropdown,{data:this.$dropdown.data("data"),filterable:!0,selectable:!0,search:{fields:["name"]},clicked:function(t){return e.reportSelectionName(t)},text:function(e){return e.name}})}}class x extends S{constructor(e){let{mediator:t}=e;super(t),this.config={key:"gitignore",name:".gitignore",pattern:/(.gitignore)/,type:"gitignores",dropdown:".js-gitignore-selector",wrapper:".js-gitignore-selector-wrap"}}initDropdown(){var e=this;Object(w.a)(this.$dropdown,{data:this.$dropdown.data("data"),filterable:!0,selectable:!0,search:{fields:["name"]},clicked:function(t){return e.reportSelectionName(t)},text:function(e){return e.name}})}}class v extends S{constructor(e){let{mediator:t}=e;super(t),this.config={key:"license",name:"LICENSE",pattern:/^(.+\/)?(licen[sc]e|copying)($|\.)/i,type:"licenses",dropdown:".js-license-selector",wrapper:".js-license-selector-wrap"}}initDropdown(){var e=this;Object(w.a)(this.$dropdown,{data:this.$dropdown.data("data"),filterable:!0,selectable:!0,search:{fields:["name"]},clicked:function(t){const{e:n}=t,i=t.$el,o=t.selectedObj,r={project:e.$dropdown.data("project"),fullname:e.$dropdown.data("fullname"),source_template_project_id:o.project_id};e.reportSelection({query:o.id,el:i,e:n,data:r})},text:function(e){return e.name}})}}class $ extends S{constructor(e){let{mediator:t}=e;super(t),this.config={key:"metrics-dashboard-yaml",name:".metrics-dashboard.yml",pattern:/(.metrics-dashboard.yml)/,type:"metrics_dashboard_ymls",dropdown:".js-metrics-dashboard-selector",wrapper:".js-metrics-dashboard-selector-wrap"}}initDropdown(){var e=this;Object(w.a)(this.$dropdown,{data:this.$dropdown.data("data"),filterable:!0,selectable:!0,search:{fields:["name"]},clicked:function(t){return e.reportSelectionName(t)},text:function(e){return e.name}})}}class k extends S{constructor(e){let{mediator:t,dropdownData:n}=e;super(t),this.mediator=t,this.config={dropdown:".js-template-type-selector",wrapper:".js-template-type-selector-wrap",dropdownData:n}}initDropdown(){var e=this;Object(w.a)(this.$dropdown,{data:this.config.dropdownData,filterable:!1,selectable:!0,clicked:function(t){return e.mediator.selectTemplateTypeOptions(t)},text:function(e){return e.name}})}}class j{constructor(e){let{editor:t,currentAction:n,projectId:i}=e;this.editor=t,this.currentAction=n,this.projectId=i,this.initTemplateSelectors(),this.initTemplateTypeSelector(),this.initDomElements(),this.initDropdowns(),this.initPageEvents(),this.cacheFileContents()}initTemplateSelectors(){var e=this;this.templateSelectors=[x,y,b,$,T,v].map((function(t){return new t({mediator:e})}))}initTemplateTypeSelector(){this.typeSelector=new k({mediator:this,dropdownData:this.templateSelectors.map((function(e){const t=e.config;return{name:t.name,key:t.key,id:t.key}})).reduce((function(e,t){return e.find((function(e){return e.id===t.id}))?e:[...e,t]}),[])})}initDomElements(){const e=o()(".template-selectors-menu"),t=e.find(".template-selectors-undo-menu"),n=o()(".file-editor");this.$templatesMenu=e,this.$undoMenu=t,this.$undoBtn=t.find("button"),this.$templateSelectors=e.find(".template-selector-dropdowns-wrap"),this.$filenameInput=n.find(".js-file-path-name-input"),this.$fileContent=n.find("#file-content"),this.$commitForm=n.find("form"),this.$navLinks=n.find(".nav-links"),this.$templateTypes=this.$templateSelectors.find(".template-type-selector")}initDropdowns(){"create"===this.currentAction?this.typeSelector.show():this.hideTemplateSelectorMenu(),this.displayMatchedTemplateSelector()}initPageEvents(){this.listenForFilenameInput(),this.listenForPreviewMode()}listenForFilenameInput(){var e=this;this.$filenameInput.on("keyup blur",(function(){e.displayMatchedTemplateSelector()}))}listenForPreviewMode(){var e=this;this.$navLinks.on("click","a",(function(t){const n=t.target.href.split("#")[1];"preview"===n?e.hideTemplateSelectorMenu():"editor"!==n||e.typeSelector.isHidden()||e.showTemplateSelectorMenu()}))}selectTemplateType(e,t){t&&t.preventDefault(),this.templateSelectors.forEach((function(t){t.config.key===e.key?t.show():t.hide()})),this.setTypeSelectorToggleText(e.name),this.cacheToggleText()}selectTemplateTypeOptions(e){this.selectTemplateType(e.selectedObj,e.e)}selectTemplateFile(e,t,n){var i=this;const o=this,{name:r}=e.config,s=document.querySelector(".js-suggest-gitlab-ci-yml-commit-changes");e.renderLoading(),this.fetchFileTemplate(e.config.type,t,n).then((function(n){i.setEditorContent(n),i.setFilename(r),e.renderLoaded(),i.typeSelector.setToggleText(r),Object(m.a)(Object(f.a)("".concat(t," template applied")),{action:{text:Object(f.a)("Undo"),onClick:function(e,t){o.restoreFromCache(),t.goAway(0)}}}),s&&Object(g.a)(s)})).catch((function(e){return new l.c("An error occurred while fetching the template: ".concat(e))}))}displayMatchedTemplateSelector(){var e=this;const t=this.getFilename();this.templateSelectors.forEach((function(n){n.config.pattern.test(t)&&(e.typeSelector.show(),e.selectTemplateType(n.config),e.showTemplateSelectorMenu())}))}fetchFileTemplate(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise((function(o){h.a.projectTemplate(n.projectId,e,t,i,(function(e){return o(e)}))}))}setEditorContent(e){if(!e&&""!==e)return;const t=e.content||e;this.editor.setValue(t,1),this.editor.focus(),this.editor.navigateFileStart()}findTemplateSelectorByKey(e){return this.templateSelectors.find((function(t){return t.config.key===e}))}hideTemplateSelectorMenu(){this.$templatesMenu.hide()}showTemplateSelectorMenu(){this.$templatesMenu.show()}cacheToggleText(){this.cachedToggleText=this.getTemplateSelectorToggleText()}cacheFileContents(){this.cachedContent=this.editor.getValue(),this.cachedFilename=this.getFilename()}restoreFromCache(){this.setEditorContent(this.cachedContent),this.setFilename(this.cachedFilename),this.setTemplateSelectorToggleText(),this.setTypeSelectorToggleText(Object(f.a)("Select a template type"))}getTemplateSelectorToggleText(){return this.$templateSelectors.find(".js-template-selector-wrap:visible .dropdown-toggle-text").text()}setTemplateSelectorToggleText(){return this.$templateSelectors.find(".js-template-selector-wrap:visible .dropdown-toggle-text").text(this.cachedToggleText)}getTypeSelectorToggleText(){return this.typeSelector.getToggleText()}setTypeSelectorToggleText(e){this.typeSelector.setToggleText(e)}getFilename(){return this.$filenameInput.val()}setFilename(e){this.$filenameInput.val(e).trigger("change")}getSelected(){return this.templateSelectors.find((function(e){return e.selected}))}}const O=Object(f.a)("An error occurred while rendering the editor"),E=Object(f.a)("An error occurred previewing the blob");class M{constructor(e){var t=this;this.options=e,this.configureMonacoEditor(),this.options.isMarkdown&&n.e(676).then(n.bind(null,"tCo4")).then((function(){let{EditorMarkdownExtension:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.editor.use(new e),Object(p.a)(t.editor)})).catch((function(e){return Object(l.c)("".concat(O,": ").concat(e))})),this.initModePanesAndLinks(),this.initFileSelectors(),this.initSoftWrap(),this.editor.focus()}configureMonacoEditor(){var e=this;const t=document.getElementById("editor"),n=document.getElementById("file_path")||document.getElementById("file_name"),i=document.getElementById("file-content"),o=document.querySelector(".js-edit-blob-form"),s=new r.default;this.editor=s.createInstance({el:t,blobPath:n.value,blobContent:t.innerText}),this.editor.use(new c({instance:this.editor})),n.addEventListener("change",(function(){e.editor.updateModelLanguage(n.value)})),o.addEventListener("submit",(function(){i.value=Object(u.m)(e.editor.getValue())}))}initFileSelectors(){const{currentAction:e,projectId:t}=this.options;this.fileTemplateMediator=new j({currentAction:e,editor:this.editor,projectId:t})}initModePanesAndLinks(){var e=this;this.$editModePanes=o()(".js-edit-mode-pane"),this.$editModeLinks=o()(".js-edit-mode a"),this.$editModeLinks.on("click",(function(t){return e.editModeLinkClickHandler(t)}))}editModeLinkClickHandler(e){e.preventDefault();const t=o()(e.target),n=t.attr("href"),i=this.$editModePanes.filter(n);return this.$editModeLinks.parent().removeClass("active hover"),t.parent().addClass("active hover"),this.$editModePanes.hide(),i.show(),"#preview"===n&&(this.$toggleButton.hide(),d.a.post(t.data("previewUrl"),{content:this.editor.getValue()}).then((function(e){let{data:t}=e;i.empty().append(t),i.renderGFM()})).catch((function(){return Object(l.c)(E)}))),this.$toggleButton.show(),this.editor.focus()}initSoftWrap(){var e=this;this.isSoftWrapped=!0,this.$toggleButton=o()(".soft-wrap-toggle"),this.$toggleButton.toggleClass("soft-wrap-active",this.isSoftWrapped),this.$toggleButton.on("click",(function(){return e.toggleSoftWrap()}))}toggleSoftWrap(){this.isSoftWrapped=!this.isSoftWrapped,this.$toggleButton.toggleClass("soft-wrap-active",this.isSoftWrapped),this.editor.updateOptions({wordWrap:this.isSoftWrapped?"on":"off"})}}},tXF7:function(e,t,n){"use strict";n.d(t,"b",(function(){return g})),n.d(t,"a",(function(){return f})),n.d(t,"c",(function(){return m}));n("GzNv"),n("S26F"),n("pBsb"),n("+xeR"),n("orcL"),n("pETN");var i=n("EmJ/"),o=n.n(i),r=n("v+Mp"),s=n("NmEs");const a="[{text}](url)";function c(e,t){return"".concat(e,"\n").concat(t,"\n").concat(e)}function l(e){return{start:{row:(t=e.getSelection()).startLineNumber,column:t.startColumn},end:{row:t.endLineNumber,column:t.endColumn}};var t}function d(e){let t,n,i,o,{textArea:r,text:d,tag:p,cursorOffset:u,blockTag:h,selected:g="",wrap:f,select:m,editor:w}=e,S=!1,b=!1,y=!1;if(g=g.toString(),w){const e=l(w);t=e.start,n=e.end}if(p===a&&URL)try{new URL(g),p="[text]({text})",m="text"}catch(e){}0===g.indexOf("\n")&&(b=!0,g=g.replace(/\n+/,"")),r?r.selectionEnd-r.selectionStart>g.replace(/\n$/,"").length&&(S=!0,g=g.replace(/\n$/,"")):w&&t.row!==n.row&&(S=!0,g=g.replace(/\n$/,""));const T=g.split("\n");w&&!f?(i=w.getValue().split("\n")[t.row],/^\s*$/.test(i)&&(y=!0)):r&&!f&&(i=r.value.substr(0,r.selectionStart).lastIndexOf("\n"),/^\s*$/.test(r.value.substring(i,r.selectionStart))&&(y=!0));const x=r&&0===r.selectionStart||w&&0===t.column&&0===t.row,v=f||y||x?"":"\n";return o=T.length>1&&(!f||null!=h&&""!==h)?null!=h&&""!==h?w?function(e,t,n,i){const o=e.split("\n"),r=l(i);if(o[r.start.row-1]===t&&o[r.end.row+1]===t){if(null!==t){const e=o[r.end.row+1],t=new Range(o[r.start.row-1],0,r.end.row+1,e.length);i.getSelection().setSelectionRange(t)}return n}return c(t,n)}(d,h,g,w):function(e,t,n,i){return function(e,t){const n=e.substring(0,t.selectionStart).trim().split("\n");return n[n.length-1]}(e,t)===n&&function(e,t){return e.substring(t.selectionEnd).trim().split("\n")[0]}(e,t)===n?(null!=n&&(t.selectionStart=t.selectionStart-(n.length+1),t.selectionEnd=t.selectionEnd+(n.length+1)),i):c(n,i)}(d,r,h,g):T.map((function(e){return p.indexOf("{text}")>-1?p.replace("{text}",e):0===e.indexOf(p)?String(e.replace(p,"")):String(p)+e})).join("\n"):p.indexOf("{text}")>-1?p.replace("{text}",g.replace(/\\n/g,"\n")):String(v)+p+g+(f?p:""),b&&(o="\n".concat(o)),S&&(o+="\n"),w?w.replaceSelectedText(o,m):Object(s.w)(r,o),function(e){let t,{textArea:n,tag:i,cursorOffset:o,positionBetweenTags:r,removedLastNewLine:s,select:a,editor:c,editorSelectionStart:l,editorSelectionEnd:d}=e;if(!n||n.setSelectionRange){if(a&&a.length>0){if(n){const e=n.selectionStart-(i.length-i.indexOf(a)),t=e+a.length;return n.setSelectionRange(e,t)}if(c)return void c.selectWithinSelection(a,i)}if(n){if(n.selectionStart===n.selectionEnd)return t=r?n.selectionStart-i.length:n.selectionStart,s&&(t-=1),o&&(t-=o),n.setSelectionRange(t,t)}else c&&l.row===d.row&&r&&c.moveCursor(-1*i.length)}}({textArea:r,tag:p.replace("{text}",g),cursorOffset:u,positionBetweenTags:f&&0===g.length,removedLastNewLine:S,select:m,editor:w,editorSelectionStart:t,editorSelectionEnd:n})}function p(e){let{textArea:t,tag:n,cursorOffset:i,blockTag:r,wrap:s,select:a,tagContent:c}=e;const l=o()(t);t=l.get(0);const p=l.val(),u=function(e,t){return e.substring(t.selectionStart,t.selectionEnd)}(p,t)||c;return l.focus(),d({textArea:t,text:p,tag:n,cursorOffset:i,blockTag:r,selected:u,wrap:s,select:a})}function u(e){if(!gon.markdown_surround_selection)return;if(this.selectionStart===this.selectionEnd)return;const t={"*":"**{text}**",_:"_{text}_","`":"`{text}`","'":"'{text}'",'"':'"{text}"',"[":"[{text}]","{":"{{text}}","(":"({text})","<":"<{text}>"}[e.key];t&&(e.preventDefault(),p({tag:t,textArea:this,blockTag:"",wrap:!0,select:"",tagContent:""}))}function h(e){return p({textArea:e.closest(".md-area").find("textarea"),tag:e.data("mdTag"),cursorOffset:e.data("mdCursorOffset"),blockTag:e.data("mdBlock"),wrap:!e.data("mdPrepend"),select:e.data("mdSelect"),tagContent:e.attr("data-md-tag-content")})}function g(e){return o()(".markdown-area",e).on("keydown",u).each((function(){r.default.initMarkdownEditorShortcuts(o()(this),h)})),o()(".js-md",e).off("click").on("click",(function(){return h(o()(this))}))}function f(e){o()(".js-md").off("click").on("click",(function(t){const{mdTag:n,mdBlock:i,mdPrepend:r,mdSelect:s}=o()(t.currentTarget).data();d({tag:n,blockTag:i,wrap:!r,select:s,selected:e.getSelectedText(),text:e.getValue(),editor:e}),e.focus()}))}function m(e){return o()(".markdown-area",e).off("keydown",u).each((function(){r.default.removeMarkdownEditorShortcuts(o()(this))})),o()(".js-md",e).off("click")}},udiD:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));n("orcL");var i=n("yWhq"),o=n("jB52");o.default.use(i.a);const r=new o.default;function s(){return r.$toast.show(...arguments)}}}]);
//# sourceMappingURL=656.c4274744.chunk.js.map